<<<<<<< HEAD
{"version":3,"file":"questionedit.min.js","sources":["../src/questionedit.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Backward compatibility file for the old popover.js\n *\n * @module     qtype_multianswerrgx/feedback\n * @copyright  2023 Jun Pataleta <jun@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* The data is stored in a hidden field */\ndefine(['jquery'], function($) {\n    /* eslint-disable no-console */\n  return {\n    init: function() {\n\n      // Init the css for the error divs.\n      let indexes = [5, 9];\n      for (let i = 0; i < indexes.length; i++) {\n        $('#id_error_button_group_add_gaps_' + indexes[i]).css({\n          display: 'inline',\n          color: 'red',\n        });\n      }\n\n      /* A click on the Add gaps 1/5 button. */\n      $('#id_button_group_add_gaps_5').on('click', function() {\n        createGaps (5);\n      });\n\n      /* A click on the Add gaps 1/9 button. */\n      $('#id_button_group_add_gaps_9').on('click', function() {\n        createGaps (9);\n      });\n\n      /* A click on the Remove gaps button. */\n      $('#id_button_group_remove_gaps_button').on('click', function() {\n        var iframe = $('#id_questiontext_ifr');\n        var iframeBody = iframe.contents().find('body');\n        var textContent = iframeBody.text();\n        var paragraphs = iframeBody.find('p');\n        // Regular expression to detect the presence of sub-questions in question text.\n        var regex = /\\{[^}]*[^}]*\\}/g;\n        var containsGaps = regex.test(textContent);\n        if (containsGaps) {\n          for (let i = 0; i < paragraphs.length; i++) {\n            let paraText = $(paragraphs[i]).text();\n            const cleanedText = paraText.replace(/\\{[^:]+:[^:]+:=(.*?)(#.*?)?\\}/g, '$1');\n            $(paragraphs[i]).text(cleanedText);\n          }\n        }\n        $('#id_button_group_remove_gaps_button').prop('disabled', true);\n        $('#id_error_button_group_add_gaps_5').html('');\n        $('#id_error_button_group_add_gaps_9').html('');\n        return;\n      });\n\n      /**\n       * Encloses every nth word in square brackets, keeping punctuation outside the brackets.\n       * @param {number} interval - The interval at which to enclose words in brackets.\n       * @returns {string} The modified text with every nth word enclosed in brackets.       *\n       */\n      function createGaps (interval) {\n        // Init error divs.\n        $('#id_error_button_group_add_gaps_5').html('');\n        $('#id_error_button_group_add_gaps_9').html('');\n        var iframe = $('#id_questiontext_ifr');\n        var iframeBody = iframe.contents().find('body');\n        var textContent = iframeBody.text();\n        var paragraphs = iframeBody.find('p');\n        // Regular expression to detect the presence of sub-questions in question text.\n        var pattern = /\\{[^}]*[^}]*\\}/g;\n        // Check if the pattern matches the string\n        if (pattern.test(textContent)) {\n          $('#id_error_button_group_add_gaps_' + interval).html(M.util.get_string(\n            'addgapserror',\n            'qtype_multianswerrgx'\n          ));\n          return;\n        }\n        let totalWords = textContent.split(' ');\n        if (totalWords.length < interval) {\n          $('#id_error_button_group_add_gaps_' + interval).html(M.util.get_string(\n            'tooshortforgapserror',\n            'qtype_multianswerrgx'\n          ));\n          return '';\n        }\n        let words;\n        let gappedText;\n        let paraText;\n        for (let i = 0; i < paragraphs.length; i++) {\n          paraText = $(paragraphs[i]).text();\n          words = paraText.split(' ');\n          // Loop through the words and enclose every 5th or 9th word in SHORTANSWER marker.\n          for (let index = 0; index < words.length; index++) {\n            if ((index + 1) % interval === 0) {\n              // Separate the word from any trailing punctuation\n              let word = words[index];\n              let punctuation = '';\n              // Check if the word ends with punctuation\n              if (/[.,!?;:]+$/.test(word)) {\n                  punctuation = word.slice(-1); // Get the punctuation mark\n                  word = word.slice(0, -1); // Remove the punctuation from the word\n              }\n              // Check if the word starts with capital letter and skip it. TODO.\n              // Enclose the word in square brackets, then add back the punctuation\n              words[index] = `{1:SA:=${word}}${punctuation}`;\n            }\n          }\n          // Join the words back into a single string\n          gappedText = words.join(' ');\n          //$('#id_add_gaps_5, #id_add_gaps_7').prop('disabled', true);\n          if (gappedText !== '') {\n            $(paragraphs[i]).text(gappedText);\n          }\n          $('#id_button_group_remove_gaps_button').prop('disabled', false);\n        }\n      }\n    }\n  };\n});\n"],"names":["define","$","init","indexes","i","length","css","display","color","createGaps","interval","html","iframeBody","contents","find","textContent","text","paragraphs","test","M","util","get_string","words","gappedText","paraText","split","index","word","punctuation","slice","join","prop","on","cleanedText","replace"],"mappings":";;;;;;;AAwBAA,2CAAO,CAAC,WAAW,SAASC,SAEnB,CACLC,KAAM,eAGAC,QAAU,CAAC,EAAG,OACb,IAAIC,EAAI,EAAGA,EAAID,QAAQE,OAAQD,IAClCH,EAAE,mCAAqCE,QAAQC,IAAIE,IAAI,CACrDC,QAAS,SACTC,MAAO,iBAyCFC,WAAYC,UAEnBT,EAAE,qCAAqCU,KAAK,IAC5CV,EAAE,qCAAqCU,KAAK,QAExCC,WADSX,EAAE,wBACSY,WAAWC,KAAK,QACpCC,YAAcH,WAAWI,OACzBC,WAAaL,WAAWE,KAAK,QAEnB,kBAEFI,KAAKH,yBACfd,EAAE,mCAAqCS,UAAUC,KAAKQ,EAAEC,KAAKC,WAC3D,eACA,6BAYAC,MACAC,WACAC,YAVaT,YAAYU,MAAM,KACpBpB,OAASK,gBACtBT,EAAE,mCAAqCS,UAAUC,KAAKQ,EAAEC,KAAKC,WAC3D,uBACA,yBAEK,OAKJ,IAAIjB,EAAI,EAAGA,EAAIa,WAAWZ,OAAQD,IAAK,CAC1CoB,SAAWvB,EAAEgB,WAAWb,IAAIY,OAC5BM,MAAQE,SAASC,MAAM,SAElB,IAAIC,MAAQ,EAAGA,MAAQJ,MAAMjB,OAAQqB,YACnCA,MAAQ,GAAKhB,UAAa,EAAG,KAE5BiB,KAAOL,MAAMI,OACbE,YAAc,GAEd,aAAaV,KAAKS,QAClBC,YAAcD,KAAKE,OAAO,GAC1BF,KAAOA,KAAKE,MAAM,GAAI,IAI1BP,MAAMI,OAAU,UAASC,QAAQC,cAIrCL,WAAaD,MAAMQ,KAAK,KAEL,KAAfP,YACFtB,EAAEgB,WAAWb,IAAIY,KAAKO,YAExBtB,EAAE,uCAAuC8B,KAAK,YAAY,IA1F9D9B,EAAE,+BAA+B+B,GAAG,SAAS,WAC3CvB,WAAY,MAIdR,EAAE,+BAA+B+B,GAAG,SAAS,WAC3CvB,WAAY,MAIdR,EAAE,uCAAuC+B,GAAG,SAAS,eAE/CpB,WADSX,EAAE,wBACSY,WAAWC,KAAK,QACpCC,YAAcH,WAAWI,OACzBC,WAAaL,WAAWE,KAAK,QAErB,kBACaI,KAAKH,iBAEvB,IAAIX,EAAI,EAAGA,EAAIa,WAAWZ,OAAQD,IAAK,OAEpC6B,YADShC,EAAEgB,WAAWb,IAAIY,OACHkB,QAAQ,iCAAkC,MACvEjC,EAAEgB,WAAWb,IAAIY,KAAKiB,aAG1BhC,EAAE,uCAAuC8B,KAAK,YAAY,GAC1D9B,EAAE,qCAAqCU,KAAK,IAC5CV,EAAE,qCAAqCU,KAAK"}
=======
{"version":3,"file":"questionedit.min.js","sources":["../src/questionedit.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Backward compatibility file for the old popover.js\n *\n * @module     qtype_multianswerrgx/feedback\n * @copyright  2023 Jun Pataleta <jun@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* The data is stored in a hidden field */\ndefine(['jquery'], function($) {\n    /* eslint-disable no-console */\n  return {\n    init: function() {\n\n      // Init the css for the error divs.\n      let indexes = [5, 9];\n      for (let i = 0; i < indexes.length; i++) {\n        $('#id_error_button_group_add_gaps_' + indexes[i]).css({\n          display: 'inline',\n          color: 'red',\n        });\n      }\n\n      /* A click on the Add gaps 1/5 button. */\n      $('#id_button_group_add_gaps_5').on('click', function() {\n        createGaps (5);\n      });\n\n      /* A click on the Add gaps 1/9 button. */\n      $('#id_button_group_add_gaps_9').on('click', function() {\n        createGaps (9);\n      });\n\n      /* A click on the Remove gaps button. */\n      $('#id_button_group_remove_gaps_button').on('click', function() {\n        var iframe = $('#id_questiontext_ifr');\n        var iframeBody = iframe.contents().find('body');\n        var textContent = iframeBody.text();\n        var paragraphs = iframeBody.find('p');\n        // Regular expression to detect the presence of sub-questions in question text.\n        var regex = /\\{[^}]*[^}]*\\}/g;\n        var containsGaps = regex.test(textContent);\n        let paraText;\n        if (containsGaps) {\n          for (let i = 0; i < paragraphs.length; i++) {\n            paraText = $(paragraphs[i]).text();\n            const cleanedText = paraText.replace(/\\{[^:]+:[^:]+:=(.*?)(#.*?)?\\}/g, '$1');\n            $(paragraphs[i]).text(cleanedText);\n          }\n        }\n        $('#id_button_group_remove_gaps_button').prop('disabled', true);\n        $('#id_error_button_group_add_gaps_5').html('');\n        $('#id_error_button_group_add_gaps_9').html('');\n        return;\n      });\n\n      /**\n       * Encloses every nth word in square brackets, keeping punctuation outside the brackets.\n       * @param {number} interval - The interval at which to enclose words in brackets.\n       * @returns {string} The modified text with every nth word enclosed in brackets.       *\n       */\n      function createGaps (interval) {\n        // Init error divs.\n        $('#id_error_button_group_add_gaps_5').html('');\n        $('#id_error_button_group_add_gaps_9').html('');\n        var iframe = $('#id_questiontext_ifr');\n        var iframeBody = iframe.contents().find('body');\n        var textContent = iframeBody.text();\n        //console.log('textContent = ' + textContent);\n        var paragraphs = iframeBody.find('p');\n        // Regular expression to detect the presence of sub-questions in question text.\n        var pattern = /\\{[^}]*[^}]*\\}/g;\n        // Check if the pattern matches the string\n        if (pattern.test(textContent)) {\n          $('#id_error_button_group_add_gaps_' + interval).html(M.util.get_string(\n            'addgapserror',\n            'qtype_multianswerrgx'\n          ));\n          return;\n        }\n        let totalWords = textContent.split(' ');\n        if (totalWords.length < interval) {\n          $('#id_error_button_group_add_gaps_' + interval).html(M.util.get_string(\n            'tooshortforgapserror',\n            'qtype_multianswerrgx'\n          ));\n          return '';\n        }\n        let wordsHtml;\n        for (let i = 0; i < paragraphs.length; i++) {\n          var paragraphHtml = $(paragraphs[i]).html();\n          wordsHtml = convertToGappedText(paragraphHtml, interval);\n          let wordsHtmlArray = wordsHtml.split(',');\n          // Join the array elements with spaces\n          let gappedTextHTLM = wordsHtmlArray.join(' ');\n          if (gappedTextHTLM !== '') {\n            $(paragraphs[i]).html(gappedTextHTLM);\n          }\n          $('#id_button_group_remove_gaps_button').prop('disabled', false);\n        }\n      }\n      /**\n       * Converts a comma-separated list of words into a gapped text, while preserving HTML tags.\n       *\n       * @param {string} text - The comma-separated string containing words and possible HTML tags.\n       * @param {number} interval - The interval at which to enclose words in brackets.\n       * @returns {string} - The transformed string with every third word replaced by '[...]'.\n       */\n      function convertToGappedText(text, interval) {\n        let words = text.split(' '); // Split the text by commas\n        let transformedText = words.map((word, index) => {\n          let trimmedWord = word.trim();\n          // Every interval word and not part of an HTML tag\n          if ((index + 1) % interval === 0 && !trimmedWord.startsWith('<') && !trimmedWord.endsWith('>')) {\n            return '{1:SA:=' + trimmedWord + '}'; // Replace the word with [...]\n          }\n          return word; // Return the original word if it's not to be replaced\n        }).join(',');\n        return transformedText;\n      }\n    }\n  };\n});\n"],"names":["define","$","init","indexes","i","length","css","display","color","createGaps","interval","html","iframeBody","contents","find","textContent","text","paragraphs","test","M","util","get_string","wordsHtml","split","convertToGappedText","gappedTextHTLM","join","prop","map","word","index","trimmedWord","trim","startsWith","endsWith","on","paraText","cleanedText","replace"],"mappings":";;;;;;;AAwBAA,2CAAO,CAAC,WAAW,SAASC,SAEnB,CACLC,KAAM,eAGAC,QAAU,CAAC,EAAG,OACb,IAAIC,EAAI,EAAGA,EAAID,QAAQE,OAAQD,IAClCH,EAAE,mCAAqCE,QAAQC,IAAIE,IAAI,CACrDC,QAAS,SACTC,MAAO,iBA0CFC,WAAYC,UAEnBT,EAAE,qCAAqCU,KAAK,IAC5CV,EAAE,qCAAqCU,KAAK,QAExCC,WADSX,EAAE,wBACSY,WAAWC,KAAK,QACpCC,YAAcH,WAAWI,OAEzBC,WAAaL,WAAWE,KAAK,QAEnB,kBAEFI,KAAKH,yBACfd,EAAE,mCAAqCS,UAAUC,KAAKQ,EAAEC,KAAKC,WAC3D,eACA,6BAYAC,aARaP,YAAYQ,MAAM,KACpBlB,OAASK,gBACtBT,EAAE,mCAAqCS,UAAUC,KAAKQ,EAAEC,KAAKC,WAC3D,uBACA,yBAEK,OAGJ,IAAIjB,EAAI,EAAGA,EAAIa,WAAWZ,OAAQD,IAAK,CAE1CkB,UAAYE,oBADQvB,EAAEgB,WAAWb,IAAIO,OACUD,cAG3Ce,eAFiBH,UAAUC,MAAM,KAEDG,KAAK,KAClB,KAAnBD,gBACFxB,EAAEgB,WAAWb,IAAIO,KAAKc,gBAExBxB,EAAE,uCAAuC0B,KAAK,YAAY,aAUrDH,oBAAoBR,KAAMN,iBACrBM,KAAKO,MAAM,KACKK,KAAI,CAACC,KAAMC,aACjCC,YAAcF,KAAKG,cAElBF,MAAQ,GAAKpB,UAAa,GAAMqB,YAAYE,WAAW,MAASF,YAAYG,SAAS,KAGnFL,KAFE,UAAYE,YAAc,OAGlCL,KAAK,KA7FVzB,EAAE,+BAA+BkC,GAAG,SAAS,WAC3C1B,WAAY,MAIdR,EAAE,+BAA+BkC,GAAG,SAAS,WAC3C1B,WAAY,MAIdR,EAAE,uCAAuCkC,GAAG,SAAS,eAE/CvB,WADSX,EAAE,wBACSY,WAAWC,KAAK,QACpCC,YAAcH,WAAWI,OACzBC,WAAaL,WAAWE,KAAK,SAI7BsB,YAFQ,kBACalB,KAAKH,iBAGvB,IAAIX,EAAI,EAAGA,EAAIa,WAAWZ,OAAQD,IAAK,CAC1CgC,SAAWnC,EAAEgB,WAAWb,IAAIY,aACtBqB,YAAcD,SAASE,QAAQ,iCAAkC,MACvErC,EAAEgB,WAAWb,IAAIY,KAAKqB,aAG1BpC,EAAE,uCAAuC0B,KAAK,YAAY,GAC1D1B,EAAE,qCAAqCU,KAAK,IAC5CV,EAAE,qCAAqCU,KAAK"}
>>>>>>> 339a84f1effb95f1fbf2090c11118f0cf11b3b0b
